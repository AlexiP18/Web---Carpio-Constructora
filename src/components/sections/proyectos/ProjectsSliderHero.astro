---
import { Icon } from "astro-icon/components";
import Button from '../../ui/Button.astro';

// Project images from public folder
const arrayanesIzambaImage = '/images/projects/arrayanes_izamba/1. exterior/vista.webp';
const keopsImage = '/images/projects/keops/2. interior/0. Principal_Vertical.webp';

// Datos de proyectos - estos podrían venir de una colección o API
const projects = [
  {
    id: 1,
    title: "Los Arrayanes de Izamba",
    subtitle: "Conjunto habitacional moderno",
    description: "Conjunto habitacional diseñado para ofrecer calidad de vida y espacios funcionales para toda la familia, con acabados de primera y áreas comunes.",
    image: "https://res.cloudinary.com/dt5y4fsst/image/upload/v1769492057/Arrayanes_Izamba_iqjg5y.webp",
    category: "Residencial",
    area: "166 m²",
    year: "2025",
    location: "Izamba, Ecuador",
    status: "Completado"
  },
  {
    id: 2,
    title: "KEOPS",
    subtitle: "Diseños Retail",
    description: "Espacios comerciales innovadores diseñados para potenciar la experiencia de compra con layouts modernos y funcionales que maximizan el flujo de clientes.",
    image: "https://res.cloudinary.com/dt5y4fsst/image/upload/v1769492074/Keop_Principal_hk9boh.webp",
    category: "Comercial",
    area: "2,800 m²",
    year: "2025",
    location: "Ecuador",
    status: "Completado",
    hideArea: true
  },
  {
    id: 3,
    title: "Casa Amaranto",
    subtitle: "Residencia Moderna",
    description: "Diseño arquitectónico contemporáneo que integra espacios interiores y exteriores, priorizando la iluminación natural y el confort.",
    image: "/images/projects/casa_amaranto/1. exterior/3._Exterior_Frontal.webp",
    category: "Residencial",
    area: "320 m²",
    year: "2024",
    location: "Ambato, Ecuador",
    status: "Completado"
  },
  {
    id: 4,
    title: "Casa Magna",
    subtitle: "Vivienda de Lujo",
    description: "Residencia exclusiva con acabados de alta gama, amplias zonas sociales y un diseño imponente que destaca en su entorno.",
    image: "/images/projects/casa_magna/1. exterior/0_Vista_Principal.webp",
    category: "Residencial",
    area: "450 m²",
    year: "2024",
    location: "Ambato, Ecuador",
    status: "Completado"
  },
  {
    id: 5,
    title: "Los Arrayanes de Ficoa",
    subtitle: "Conjunto Exclusivo",
    description: "Proyecto residencial ubicado en una de las zonas más prestigiosas, combinando seguridad, elegancia y funcionalidad.",
    image: "/images/projects/arrayanes_ficoa/1. exterior/0_Vista_Exterior.webp",
    category: "Residencial",
    area: "180 m²",
    year: "2023",
    location: "Ficoa, Ecuador",
    status: "Completado"
  }
];
---

<section id="projects-slider-hero" class="relative overflow-hidden">
  <!-- Projects Grid Container -->
  <div class="grid grid-cols-1 lg:grid-cols-2 w-full h-full">
    {/* Show only first 2 projects in a static grid */}
    {projects.slice(0, 2).map((project, index) => (
      <div 
        class="relative flex-shrink-0 w-full h-[calc(100vh-72px)] lg:h-[calc(100vh-72px)] bg-cover bg-center bg-no-repeat group cursor-pointer overflow-hidden project-card"
        style={`background-image: linear-gradient(180deg, rgba(16,54,70,0.4) 0%, rgba(16,54,70,0.8) 100%), url('${project.image}');`}
        data-project-url={`/proyecto/${project.title.toLowerCase().replace(/\s+/g, '-')}`}
      >
        <!-- Content Overlay -->
        <div class="absolute inset-0 flex flex-col justify-end p-8 lg:p-12 text-white z-10">
          <!-- Basic Info - Always visible -->
          <div class="slide-basic-info transform transition-all duration-500 ease-out">
            <div class="inline-flex items-center gap-2 bg-[#D79528] backdrop-blur-sm rounded-full px-4 py-2 mb-4 shadow-lg">
              <Icon 
                name={
                  project.category === 'Residencial' ? 'ph:house-fill' :
                  project.category === 'Comercial' ? 'ph:storefront-fill' :
                  project.category === 'Recreativo' ? 'ph:tree-fill' :
                  project.category === 'Corporativo' ? 'ph:buildings-fill' :
                  project.category === 'Salud' ? 'ph:first-aid-kit-fill' :
                  'ph:buildings-fill'
                } 
                class="w-5 h-5 text-white" 
              />
              <span class="text-sm font-bold text-white">{project.category}</span>
            </div>
            
            <h2 class="text-3xl lg:text-4xl xl:text-5xl font-extrabold mb-2 leading-tight text-white drop-shadow-lg">
              {project.title}
            </h2>
            
            <p class="text-lg lg:text-xl text-white font-medium mb-4 drop-shadow-md">
              {project.subtitle}
            </p>
          </div>

          <!-- Extended Info - Appears on hover -->
          <div class="slide-extended-info opacity-0 max-h-0 overflow-hidden transform translate-y-4 transition-all duration-500 ease-out group-hover:opacity-100 group-hover:max-h-[500px] group-hover:translate-y-0">
            <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6 mb-6 shadow-lg">
              <!-- Project Details Grid -->
              <div class="grid grid-cols-2 gap-6">
                {!project.hideArea && (
                  <div class="space-y-1">
                    <div class="flex items-center gap-2 text-white text-sm font-bold mb-1">
                      <Icon name="ph:ruler-fill" class="w-4 h-4 text-[#D79528]" />
                      Área
                    </div>
                    <div class="text-white font-bold text-lg">{project.area}</div>
                  </div>
                )}
                <div class="space-y-1">
                  <div class="flex items-center gap-2 text-white text-sm font-bold mb-1">
                    <Icon name="ph:calendar-fill" class="w-4 h-4 text-[#D79528]" />
                    Año
                  </div>
                  <div class="text-white font-bold text-lg">{project.year}</div>
                </div>
                <div class="space-y-1">
                  <div class="flex items-center gap-2 text-white text-sm font-bold mb-1">
                    <Icon name="ph:map-pin-fill" class="w-4 h-4 text-[#D79528]" />
                    Ubicación
                  </div>
                  <div class="text-white font-bold text-lg">{project.location}</div>
                </div>
                <div class="space-y-1">
                  <div class="flex items-center gap-2 text-white text-sm font-bold mb-1">
                    <Icon name="ph:check-circle-fill" class="w-4 h-4 text-[#D79528]" />
                    Estado
                  </div>
                  <div class={`font-bold text-lg ${project.status === 'Completado' ? 'text-green-600' : 'text-[#D79528]'}`}>
                    {project.status}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- CTA Buttons - Always visible -->
          <div class="mt-6">
            <div class="flex flex-col sm:flex-row gap-4">
              <a 
                href={`/proyecto/${project.title.toLowerCase().replace(/\s+/g, '-')}`}
                class="flex items-center justify-center gap-2 px-8 py-4 bg-[#D79528] hover:bg-[#c08520] text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-2xl group"
              >
                <Icon name="ph:arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform" />
                Ver Proyecto
              </a>
              <a 
                href={`https://wa.me/593998323304?text=%C2%A1Hola%20Carpio%20Constructora!%20%F0%9F%A4%A9%20Me%20encantar%C3%ADa%20conocer%20m%C3%A1s%20sobre%20su%20${encodeURIComponent(project.title)}.%20Estoy%20interesad%40%20en%20este%20proyecto.`}
                target="_blank"
                class="flex items-center justify-center gap-2 px-8 py-4 bg-[#103646] hover:bg-[#1a4a5a] text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-2xl border-2 border-white/20 group"
              >
                <Icon name="ph:whatsapp-logo-fill" class="w-5 h-5 group-hover:scale-110 transition-transform" />
                Consultar
              </a>
            </div>
          </div>
        </div>

        <!-- Gradient Overlay for better text readability -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent pointer-events-none"></div>
      </div>
    ))}
  </div>

  <!-- Scroll Down Indicator -->
  <div class="absolute bottom-8 right-8 z-20 animate-bounce">
    <div class="w-12 h-12 bg-white/10 backdrop-blur-sm border border-white/20 rounded-full flex items-center justify-center">
      <Icon name="ph:arrow-down" class="w-6 h-6 text-white" />
    </div>
  </div>
</section>

<script>
  // Handle project card clicks
  document.addEventListener('DOMContentLoaded', () => {
    const projectCards = document.querySelectorAll('.project-card');
    
    projectCards.forEach(card => {
      card.addEventListener('click', (e) => {
        // Don't redirect if clicking on buttons
        const target = e.target as HTMLElement;
        if (target.closest('a') || target.closest('button')) {
          return;
        }
        
        const projectUrl = card.getAttribute('data-project-url');
        if (projectUrl) {
          window.location.href = projectUrl;
        }
      });
    });
  });
</script>

<!-- 
<script>
  // @ts-nocheck
  // SLIDER FUNCTIONALITY DISABLED - Now using static 2-column layout
  class ProjectsSliderHero {
    constructor() {
      this.currentSlide = 0;
      this.totalSlides = 6; // Total original projects
      this.totalDisplaySlides = 12; // Duplicated projects (6 * 2)
      this.isAutoPlaying = true;
      this.autoPlayInterval = null;
      this.sliderTrack = null;
      this.indicators = null;
      this.section = null;
      this.isTransitioning = false;
      
      this.init();
    }

    init() {
      // Wait for DOM elements to be available
      this.sliderTrack = document.getElementById('slider-track');
      this.indicators = document.querySelectorAll('.slide-indicator');
      this.section = document.getElementById('projects-slider-hero');
      this.prevBtn = document.getElementById('prev-btn');
      this.nextBtn = document.getElementById('next-btn');
      
      if (!this.sliderTrack || !this.section) {
        console.warn('ProjectsSliderHero: Required elements not found');
        return;
      }
      
      this.updateSlide(0);
      this.setupIndicators();
      this.setupNavigationButtons();
      this.setupIntersectionObserver();
      this.startAutoPlay();
      this.setupMouseEvents();
    }

    updateSlide(slideIndex, instant = false) {
      if (!this.sliderTrack || this.isTransitioning) return;
      
      this.currentSlide = slideIndex;
      
      // Apply transition only if not instant
      if (instant) {
        this.sliderTrack.style.transition = 'none';
      } else {
        this.sliderTrack.style.transition = 'transform 1000ms ease-out';
      }
      
      // Update slider position - move one column at a time (33.333% per slide)
      const translateX = -slideIndex * (100 / 3); // Always move by 1/3 of container width
      this.sliderTrack.style.transform = `translateX(${translateX}%)`;
      
      // Force reflow if instant transition
      if (instant) {
        this.sliderTrack.offsetHeight;
        this.sliderTrack.style.transition = 'transform 1000ms ease-out';
      }
      
      // Update indicators with proper styling (based on original slides cycle)
      if (this.indicators) {
        const indicatorIndex = slideIndex % this.totalSlides;
        this.indicators.forEach((indicator, index) => {
          // Reset styles
          indicator.style.backgroundColor = '';
          
          // Apply appropriate styling
          if (index === indicatorIndex) {
            indicator.style.backgroundColor = 'rgb(255, 255, 255)';
            indicator.setAttribute('aria-current', 'true');
          } else {
            indicator.style.backgroundColor = 'rgb(255 255 255 / 0.3)';
            indicator.removeAttribute('aria-current');
          }
        });
      }
    }

    nextSlide() {
      if (this.isTransitioning) return;
      
      this.isTransitioning = true;
      this.currentSlide++;
      
      this.updateSlide(this.currentSlide);
      
      // Check if we need to reset to beginning (when we reach the end of first set)
      setTimeout(() => {
        if (this.currentSlide >= this.totalSlides) {
          // Reset to beginning position without animation
          this.currentSlide = 0;
          this.updateSlide(this.currentSlide, true);
        }
        this.isTransitioning = false;
      }, 1000); // Match transition duration
    }

    prevSlide() {
      if (this.isTransitioning) return;
      
      this.isTransitioning = true;
      
      // If at beginning, jump to end position instantly
      if (this.currentSlide <= 0) {
        this.currentSlide = this.totalSlides;
        this.updateSlide(this.currentSlide, true);
        
        // Small delay then move to actual previous position
        setTimeout(() => {
          this.currentSlide--;
          this.updateSlide(this.currentSlide);
          setTimeout(() => {
            this.isTransitioning = false;
          }, 1000);
        }, 50);
      } else {
        this.currentSlide--;
        this.updateSlide(this.currentSlide);
        setTimeout(() => {
          this.isTransitioning = false;
        }, 1000);
      }
    }

    setupNavigationButtons() {
      if (this.prevBtn) {
        this.prevBtn.addEventListener('click', () => {
          this.prevSlide();
          this.startAutoPlay();
        });
      }

      if (this.nextBtn) {
        this.nextBtn.addEventListener('click', () => {
          this.nextSlide();
          this.startAutoPlay();
        });
      }
    }

    startAutoPlay() {
      this.stopAutoPlay();
      this.autoPlayInterval = setInterval(() => {
        if (this.isAutoPlaying) {
          this.nextSlide();
        }
      }, 4000); // Change slide every 4 seconds
    }

    stopAutoPlay() {
      if (this.autoPlayInterval) {
        clearInterval(this.autoPlayInterval);
        this.autoPlayInterval = null;
      }
    }

    setupMouseEvents() {
      if (!this.section) return;
      
      // Pause auto-play on hover
      this.section.addEventListener('mouseenter', () => {
        this.isAutoPlaying = false;
      });

      this.section.addEventListener('mouseleave', () => {
        this.isAutoPlaying = true;
      });
    }

    setupIndicators() {
      if (!this.indicators) return;
      
      this.indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
          if (this.isTransitioning) return;
          
          this.isTransitioning = true;
          this.currentSlide = index;
          this.updateSlide(this.currentSlide);
          
          setTimeout(() => {
            this.isTransitioning = false;
          }, 1000);
          
          // Reset auto-play timer when manually changing slides
          this.startAutoPlay();
        });
      });
    }

    setupIntersectionObserver() {
      if (!this.section) return;
      
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('in-view');
              this.isAutoPlaying = true;
              this.startAutoPlay();
            } else {
              this.isAutoPlaying = false;
              this.stopAutoPlay();
            }
          });
        },
        { threshold: 0.5 }
      );

      observer.observe(this.section);
    }
  }

  // Initialize when DOM is loaded
  function initProjectsSlider() {
    try {
      new ProjectsSliderHero();
    } catch (error) {
      console.error('Error initializing ProjectsSliderHero:', error);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProjectsSlider);
  } else {
    // DOM is already loaded
    initProjectsSlider();
  }
</script>
-->

<style>
  /* Static 2-column layout styles */
  .slide {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  /* Smooth hover transitions */
  .slide:hover .slide-basic-info {
    transform: translateY(-20px);
  }

  /* Adjust height for mobile header (56px) */
  @media (max-width: 1023px) {
    #projects-slider-hero > div > div {
      height: calc(100vh - 56px) !important;
    }
  }

  /* Responsive adjustments */
  @media (max-width: 1024px) {
    /* Stack columns on tablet and mobile */
    .grid.grid-cols-1.lg\\:grid-cols-2 {
      grid-template-columns: 1fr;
    }
    
    .slide-extended-info {
      opacity: 1 !important;
      max-height: none !important;
      transform: none !important;
    }
    
    /* Adjust padding for mobile */
    .slide > div {
      padding: 1.5rem;
    }
    
    /* Smaller text on mobile */
    .slide h2 {
      font-size: 1.5rem !important;
      line-height: 1.2 !important;
    }
    
    .slide p {
      font-size: 1rem !important;
    }

    /* Adjust grid layout for mobile */
    .slide .grid-cols-2 {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    /* Stack buttons vertically on mobile */
    .slide .flex-col.sm\\:flex-row {
      flex-direction: column;
    }
  }

  /* Performance optimizations */
  .slide-basic-info,
  .slide-extended-info {
    will-change: transform, opacity;
  }

  /* Ensure proper stacking */
  .slide {
    position: relative;
    z-index: 1;
  }

  .slide::before {
    content: '';
    position: absolute;
    inset: 0;
    background: inherit;
    z-index: -1;
  }

  /* Improve button visibility */
  .slide .bg-white\/20 {
    backdrop-filter: blur(8px);
  }

  .slide .bg-white\/10 {
    backdrop-filter: blur(4px);
  }

  /* Fix Tailwind classes that might not be recognized */
  .bg-white\/30 {
    background-color: rgb(255 255 255 / 0.3);
  }

  .bg-white\/10 {
    background-color: rgb(255 255 255 / 0.1);
  }

  .bg-white\/20 {
    background-color: rgb(255 255 255 / 0.2);
  }

  /* 
  COMMENTED OUT - SLIDER RELATED STYLES
  
  .slide-indicator {
    background-color: rgb(255 255 255 / 0.3);
    transition: all 300ms;
  }

  .slide-indicator:hover {
    background-color: rgb(255 255 255 / 0.8);
  }

  .slider-track {
    will-change: transform;
  }
  */
</style>