---
import { Icon } from 'astro-icon/components';
import Button from '../../ui/Button.astro';

// Import project images
import projectImage1 from '../../../assets/img/projects/PROJECT_Hero_Slider_1.webp';
import projectImage2 from '../../../assets/img/projects/PROJECT_Hero_Slider_2.webp';
import projectImage3 from '../../../assets/img/projects/PROJECT_Hero_Slider_3.webp';
import projectImage4 from '../../../assets/img/projects/PROJECT_Hero_Slider_4.webp';

// Proyecto destacado principal
const featuredProject = {
  title: "Los Arrayanes de Izamba",
  subtitle: "Nuestro Proyecto Insignia",
  description: "Un desarrollo residencial de lujo que redefine el concepto de vivienda moderna en Ecuador. Con arquitectura contemporánea, espacios amplios y acabados de primera calidad, Las Palmas representa la excelencia en construcción residencial.",
  images: [
    projectImage1,
    projectImage2,
    projectImage3,
    projectImage4
  ],
  stats: [
    { icon: "ph:buildings", label: "Área Total", value: "12,500 m²" },
    { icon: "ph:house-line", label: "Unidades", value: "85 Casas" },
    { icon: "ph:calendar-check", label: "Completado", value: "2024" },
    { icon: "ph:map-pin", label: "Ubicación", value: "Ambato, Ecuador" }
  ],
  features: [
    "Diseño arquitectónico contemporáneo",
    "Acabados de primera calidad",
    "Áreas verdes y recreativas",
    "Seguridad 24/7",
    "Parqueaderos techados",
    "Club house privado"
  ],
  highlights: [
    { number: "85", label: "Unidades Residenciales", icon: "ph:house-fill" },
    { number: "100%", label: "Satisfacción", icon: "ph:star-fill" },
    { number: "12,500", label: "m² Construidos", icon: "ph:ruler-fill" }
  ]
};
---

<section class="py-20 bg-gradient-to-br from-gray-50 via-white to-gray-50 relative overflow-hidden">
  <!-- Background decorations -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute top-20 left-10 w-64 h-64 bg-brand-primary/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 right-10 w-80 h-80 bg-brand-secondary/5 rounded-full blur-3xl"></div>
  </div>

  <div class="max-w-7xl mx-auto px-6 relative z-10">
    <!-- Section Header -->
    <div class="text-center max-w-3xl mx-auto mb-16" data-aos="fade-up">
      <div class="inline-flex items-center gap-2 bg-brand-secondary/10 backdrop-blur-sm border border-brand-secondary/20 rounded-full px-4 py-2 mb-6">
        <Icon name="ph:trophy-fill" class="w-5 h-5 text-brand-secondary" />
        <span class="text-brand-secondary font-semibold text-sm uppercase tracking-wider">Proyecto Destacado</span>
      </div>
      
      <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 leading-tight mb-4">
        {featuredProject.subtitle}
      </h2>
      
      <p class="text-lg text-gray-600">
        Descubre nuestro proyecto más emblemático que representa la excelencia en construcción
      </p>
    </div>

    <!-- Featured Project Content -->
    <div class="grid lg:grid-cols-2 gap-12 items-center">
      <!-- Image Gallery Column -->
      <div class="relative" data-aos="fade-right" data-aos-duration="1000">
        <!-- Image Slider Container -->
        <div class="relative rounded-3xl overflow-hidden shadow-2xl group" id="featured-slider">
          <!-- Slider Images -->
          <div class="relative h-[500px]">
            {featuredProject.images.map((image, index) => (
              <div 
                class={`featured-slide absolute inset-0 w-full h-full transition-opacity duration-1000 ${index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
                data-slide-index={index}
              >
                <img 
                  src={image.src} 
                  alt={`${featuredProject.title} - Imagen ${index + 1}`}
                  class="w-full h-full object-cover"
                />
              </div>
            ))}
          </div>
          
          <!-- Overlay gradient -->
          <div class="absolute inset-0 bg-gradient-to-t from-gray-900/60 via-transparent to-transparent pointer-events-none z-20"></div>
          
          <!-- Title overlay on image -->
          <div class="absolute bottom-0 left-0 right-0 p-8 text-white z-20">
            <h3 class="text-3xl font-bold mb-2">{featuredProject.title}</h3>
            <div class="flex items-center gap-2 text-white/90">
              <Icon name="ph:map-pin-fill" class="w-5 h-5" />
              <span>Ambato, Ecuador</span>
            </div>
          </div>

          <!-- Slider Dots -->
          <div class="absolute bottom-24 left-1/2 transform -translate-x-1/2 flex space-x-2 z-30">
            {featuredProject.images.map((_, index) => (
              <button 
                class={`featured-dot w-2 h-2 rounded-full transition-all duration-300 ${index === 0 ? 'bg-white w-8' : 'bg-white/50'}`}
                data-dot-index={index}
                aria-label={`Ir a imagen ${index + 1}`}
              ></button>
            ))}
          </div>
        </div>

        <!-- Floating Stats Cards -->
        <div class="grid grid-cols-3 gap-4 mt-6">
          {featuredProject.highlights.map((highlight) => (
            <div class="bg-white rounded-2xl p-4 shadow-lg border border-gray-100 hover:border-brand-primary/30 transition-all duration-300 hover:shadow-xl">
              <div class="text-center">
                <div class="w-10 h-10 bg-brand-primary/10 rounded-xl flex items-center justify-center mx-auto mb-2">
                  <Icon name={highlight.icon} class="w-5 h-5 text-brand-primary" />
                </div>
                <div class="text-2xl font-bold text-gray-900">{highlight.number}</div>
                <div class="text-xs text-gray-600 mt-1">{highlight.label}</div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Content Column -->
      <div class="space-y-8" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="200">
        <!-- Description -->
        <div>
          <p class="text-lg text-gray-700 leading-relaxed">
            {featuredProject.description}
          </p>
        </div>

        <!-- Project Stats Grid -->
        <div class="grid grid-cols-2 gap-4">
          {featuredProject.stats.map((stat) => (
            <div class="bg-gradient-to-br from-gray-50 to-white rounded-2xl p-5 border border-gray-200/50 hover:border-brand-primary/30 transition-all duration-300">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-brand-primary/10 rounded-xl flex items-center justify-center flex-shrink-0">
                  <Icon name={stat.icon} class="w-6 h-6 text-brand-primary" />
                </div>
                <div>
                  <div class="text-xs text-gray-600 uppercase tracking-wide">{stat.label}</div>
                  <div class="text-lg font-bold text-gray-900">{stat.value}</div>
                </div>
              </div>
            </div>
          ))}
        </div>

        <!-- Features List -->
        <div>
          <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <Icon name="ph:check-circle-fill" class="w-6 h-6 text-brand-secondary" />
            Características Destacadas
          </h4>
          <div class="grid grid-cols-2 gap-3">
            {featuredProject.features.map((feature) => (
              <div class="flex items-start gap-2 text-gray-700">
                <Icon name="ph:check" class="w-5 h-5 text-brand-secondary flex-shrink-0 mt-0.5" />
                <span class="text-sm">{feature}</span>
              </div>
            ))}
          </div>
        </div>

        <!-- CTA Buttons -->
        <div class="flex flex-wrap gap-4 pt-4">
          <Button 
            href="/proyecto/residencial-las-palmas"
            variant="primary"
            size="lg"
            icon="ph:arrow-right"
            iconPosition="right"
            class="bg-brand-primary hover:bg-brand-primary/90"
          >
            Ver Proyecto Completo
          </Button>
        </div>
      </div>
    </div>

    <!-- Additional Info Banner -->
    <!-- <div class="mt-16 bg-gradient-to-br from-brand-primary to-brand-primary-dark rounded-3xl p-8 lg:p-12 text-white relative overflow-hidden" data-aos="fade-up" data-aos-delay="400">
      <div class="absolute inset-0 opacity-10">
        <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-brand-secondary rounded-full blur-2xl"></div>
      </div>

      <div class="relative z-10 text-center max-w-4xl mx-auto">
        <Icon name="ph:lightbulb-fill" class="w-16 h-16 mx-auto mb-6 text-brand-secondary" />
        <h3 class="text-3xl lg:text-4xl font-bold mb-4">
          ¿Tienes un proyecto en mente?
        </h3>
        <p class="text-xl text-white/90 mb-8 leading-relaxed">
          Convertimos tus ideas en realidad con la misma excelencia y dedicación que caracteriza nuestros proyectos destacados. Contáctanos hoy y comencemos a construir juntos.
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <Button 
            href="/contacto"
            variant="outline"
            size="lg"
            icon="ph:chat-circle-text"
            iconPosition="left"
            class="bg-white text-brand-primary hover:bg-white/90 border-white"
          >
            Solicitar Consulta
          </Button>
          <Button 
            href="https://wa.me/593956324598"
            variant="outline"
            size="lg"
            icon="ph:whatsapp-logo"
            iconPosition="left"
            class="border-white text-white hover:bg-white hover:text-brand-primary"
          >
            WhatsApp
          </Button>
        </div>
      </div>
    </div> -->
  </div>
</section>

<script>
  // Featured Project Image Slider with Auto-play
  class FeaturedSlider {
    private currentIndex = 0;
    private slides: HTMLElement[] = [];
    private dots: HTMLElement[] = [];
    private totalSlides = 0;
    private autoPlayInterval: number | null = null;
    private transitionDuration = 5000; // 5 seconds
    
    constructor() {
      this.init();
    }
    
    private init(): void {
      this.slides = Array.from(document.querySelectorAll('.featured-slide'));
      this.dots = Array.from(document.querySelectorAll('.featured-dot'));
      this.totalSlides = this.slides.length;
      
      if (this.totalSlides === 0) {
        console.error('No featured slider slides found!');
        return;
      }
      
      // Add click listeners to dots
      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });
      
      // Start autoplay
      this.startAutoPlay();
      
      // Pause on hover
      const sliderContainer = document.getElementById('featured-slider');
      if (sliderContainer) {
        sliderContainer.addEventListener('mouseenter', () => this.pauseAutoPlay());
        sliderContainer.addEventListener('mouseleave', () => this.startAutoPlay());
      }
    }
    
    private updateSlider(newIndex: number): void {
      // Update slides
      this.slides.forEach((slide, index) => {
        if (index === newIndex) {
          slide.classList.remove('opacity-0', 'z-0');
          slide.classList.add('opacity-100', 'z-10');
        } else {
          slide.classList.remove('opacity-100', 'z-10');
          slide.classList.add('opacity-0', 'z-0');
        }
      });
      
      // Update dots
      this.dots.forEach((dot, index) => {
        if (index === newIndex) {
          dot.classList.remove('bg-white/50', 'w-2');
          dot.classList.add('bg-white', 'w-8');
        } else {
          dot.classList.remove('bg-white', 'w-8');
          dot.classList.add('bg-white/50', 'w-2');
        }
      });
      
      this.currentIndex = newIndex;
    }
    
    private goToSlide(index: number): void {
      if (index !== this.currentIndex && index >= 0 && index < this.totalSlides) {
        this.updateSlider(index);
        this.resetAutoPlay();
      }
    }
    
    private nextSlide(): void {
      const nextIndex = (this.currentIndex + 1) % this.totalSlides;
      this.goToSlide(nextIndex);
    }
    
    private startAutoPlay(): void {
      this.autoPlayInterval = window.setInterval(() => {
        this.nextSlide();
      }, this.transitionDuration);
    }
    
    private pauseAutoPlay(): void {
      if (this.autoPlayInterval) {
        clearInterval(this.autoPlayInterval);
        this.autoPlayInterval = null;
      }
    }
    
    private resetAutoPlay(): void {
      this.pauseAutoPlay();
      this.startAutoPlay();
    }
  }
  
  // Initialize slider when DOM is ready
  function initFeaturedSlider() {
    try {
      new FeaturedSlider();
    } catch (error) {
      console.error('Error initializing Featured Slider:', error);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFeaturedSlider);
  } else {
    initFeaturedSlider();
  }
</script>

<style>
  /* Smooth transitions for slider */
  .featured-slide {
    transition: opacity 1s ease-in-out, z-index 0s 1s;
  }
  
  .featured-slide.opacity-100 {
    transition: opacity 1s ease-in-out, z-index 0s;
  }
  
  /* Dot animations */
  .featured-dot {
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .featured-dot:hover {
    transform: scale(1.2);
    background-color: white !important;
  }
</style>
