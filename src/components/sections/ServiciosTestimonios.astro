---
import { Icon } from "astro-icon/components";

const testimonials = [
  {
    quote: "El equipo superó nuestras expectativas en cada etapa del proyecto.",
    avatar: "/images/testimonial-1.jpg",
    name: "Juan Pérez",
    title: "Gerente, Constructora XYZ",
    logo: "/images/webflow-logo.svg"
  },
  {
    quote: "La calidad del trabajo fue excepcional y muy profesional.",
    avatar: "/images/testimonial-2.jpg",
    name: "María Gómez",
    title: "Directora, Inversiones ABC",
    logo: "/images/webflow-logo.svg"
  },
  {
    quote: "Cumplieron con todos los plazos y la calidad fue impecable.",
    avatar: "/images/testimonial-3.jpg",
    name: "Carlos Mendoza",
    title: "Propietario, Desarrollos Del Sur",
    logo: "/images/webflow-logo.svg"
  },
  {
    quote: "Un equipo altamente profesional que transformó nuestra visión en realidad.",
    avatar: "/images/testimonial-4.jpg",
    name: "Ana Torres",
    title: "Coordinadora, Inmuebles Premium",
    logo: "/images/webflow-logo.svg"
  }
];

const slides = [
  [testimonials[0], testimonials[1]],
  [testimonials[2], testimonials[3]]
];
---

<section class="bg-white py-28 px-16" data-aos="fade-up">
  <div class="max-w-[1280px] mx-auto flex flex-col gap-20">
    <div class="max-w-[768px]" data-aos="fade-up">
      <h2 class="font-urbanist font-medium text-[60px] leading-[1.2] tracking-[0.6px] text-[#0c0801]">
        Testimonios de clientes
      </h2>
      <p class="font-heebo font-normal text-[20px] leading-[1.6] text-[#0c0801]">
        Nuestros clientes comparten sus experiencias con nosotros.
      </p>
    </div>

    <div class="flex flex-col gap-12">
      <div class="overflow-hidden">
        <div class="flex transition-transform duration-500 ease-in-out" id="testimonials-slider">
          {slides.map((slide, slideIndex) => (
            <div class={`w-full flex-shrink-0 grid grid-cols-1 lg:grid-cols-2 gap-16 ${slideIndex > 0 ? 'hidden' : ''}`} data-aos="fade-up" data-aos-delay={slideIndex * 100}>
              {slide.map((testimonial, testimonialIndex) => (
                <div class="flex flex-col gap-8 pr-16" data-aos="fade-up" data-aos-delay={testimonialIndex * 150}>
                  <div class="flex gap-1">
                    {[...Array(5)].map((_, i) => (
                      <Icon name="ph:star-fill" class="w-5 h-5 text-yellow-400" />
                    ))}
                  </div>
                  <blockquote class="font-urbanist font-medium text-[26px] leading-[1.2] tracking-[0.26px] text-[#0c0801]">
                    "{testimonial.quote}"
                  </blockquote>
                  <div class="flex items-center gap-5">
                    <div class="w-14 h-14 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
                      <img src={testimonial.avatar} alt={testimonial.name} class="w-full h-full object-cover" />
                    </div>
                    <div class="flex flex-col">
                      <p class="font-heebo font-semibold text-[18px] leading-[1.6] text-[#0c0801]">
                        {testimonial.name}
                      </p>
                      <p class="font-heebo font-normal text-[18px] leading-[1.6] text-[#0c0801]">
                        {testimonial.title}
                      </p>
                    </div>
                    <div class="w-[2px] h-[61px] bg-[#0c0801] mx-5"></div>
                    <div class="w-[120px] h-12 flex items-center justify-center overflow-hidden">
                      <img src={testimonial.logo} alt="Company Logo" class="max-w-full max-h-full object-contain" />
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ))}
        </div>
      </div>

      <div class="flex items-center justify-between">
        <div class="flex gap-2">
          {slides.map((_, index) => (
            <button 
              class={`w-2 h-2 rounded-full bg-[#0c0801] transition-opacity duration-300 dot-indicator ${index === 0 ? 'opacity-100' : 'opacity-30'}`}
              data-slide={index}
            ></button>
          ))}
        </div>
        <div class="flex gap-4" data-aos="fade-up" data-aos-delay="200">
          <button id="prev-testimonial" class="w-12 h-12 rounded-full border-2 border-[#0c0801] flex items-center justify-center hover:bg-gray-200 transition-colors">
            <Icon name="ph:arrow-left" class="w-6 h-6 text-[#0c0801]" />
          </button>
          <button id="next-button" class="w-12 h-12 bg-white border-2 border-[#0c0801] rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors">
            <Icon name="ph:caret-right" class="w-6 h-6 text-[#0c0801]" />
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    let currentSlide = 0;
    const slider = document.getElementById('testimonials-slider') as HTMLElement;
    const slides = slider.children;
    const totalSlides = slides.length;
    const dots = document.querySelectorAll('.dot-indicator');

    function updateSlider() {
      slider.style.transform = `translateX(-${currentSlide * 100}%)`;
      dots.forEach((dot, index) => {
        dot.classList.toggle('opacity-100', index === currentSlide);
        dot.classList.toggle('opacity-30', index !== currentSlide);
      });
    }

    document.getElementById('next-button')?.addEventListener('click', () => {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateSlider();
    });

    document.getElementById('prev-testimonial')?.addEventListener('click', () => {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateSlider();
    });

    dots.forEach(dot => {
      dot.addEventListener('click', (e) => {
        const slideIndex = parseInt((e.target as HTMLElement).dataset.slide || '0', 10);
        currentSlide = slideIndex;
        updateSlider();
      });
    });
  });
</script>
