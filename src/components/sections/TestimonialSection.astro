---
import { Icon } from 'astro-icon/components';

export interface Props {
  testimonials: Array<{
    logo: string;
    testimonial: string;
    author: {
      name: string;
      position: string;
      avatar: string;
    };
  }>;
}

const { testimonials } = Astro.props;
---

<section class="bg-white box-border content-stretch flex flex-col gap-20 items-center justify-start px-16 py-28 relative size-full">
  <div class="content-stretch flex flex-col gap-20 items-start justify-start max-w-[1280px] relative shrink-0 w-full">
    <div class="content-stretch flex flex-col gap-12 items-center justify-start relative shrink-0 w-full" id="testimonial-container">
      <div class="content-stretch flex items-center justify-start overflow-clip relative shrink-0 w-full">
        <div class="basis-0 content-stretch flex flex-col grow items-center justify-start min-h-px min-w-px relative shrink-0">
          <div class="content-stretch flex flex-col gap-8 items-center justify-start max-w-[768px] overflow-clip relative shrink-0 w-full">
            <!-- Logo -->
            <div class="h-12 overflow-clip relative shrink-0 w-[120px]">
              <div class="absolute h-[19.286px] top-1/2 translate-x-[-50%] translate-y-[-50%] w-[115.698px]" style="left: calc(50% - 0.009px)">
                <img id="testimonial-logo" alt="Logo" class="block max-w-none size-full" src={testimonials[0]?.logo || ''} />
              </div>
            </div>
            
            <!-- Testimonial Text -->
            <div class="font-['Urbanist:Medium',_sans-serif] font-medium leading-[0] min-w-full relative shrink-0 text-[#0c0801] text-[32px] text-center tracking-[0.32px]" style="width: min-content">
              <p id="testimonial-text" class="leading-[1.2]">"{testimonials[0]?.testimonial || ''}"</p>
            </div>
            
            <!-- Author Info -->
            <div class="content-stretch flex flex-col gap-4 items-center justify-start relative shrink-0 w-[300px]">
              <div class="relative shrink-0 size-14">
                <img id="testimonial-avatar" alt="" class="block max-w-none size-full rounded-full object-cover" height="56" width="56" src={testimonials[0]?.author.avatar || ''} />
              </div>
              <div class="content-stretch flex flex-col items-start justify-start leading-[0] relative shrink-0 text-[#0c0801] text-[18px] text-center w-full">
                <div class="font-['Heebo:SemiBold',_sans-serif] font-semibold relative shrink-0 w-full">
                  <p id="testimonial-name" class="leading-[1.6]">{testimonials[0]?.author.name || ''}</p>
                </div>
                <div class="font-['Heebo:Regular',_sans-serif] font-normal relative shrink-0 w-full">
                  <p id="testimonial-position" class="leading-[1.6]">{testimonials[0]?.author.position || ''}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Left Arrow -->
      <div class="absolute bg-white box-border content-stretch flex gap-2 items-center justify-center left-0 p-[12px] rounded-[100px] top-[142.67px] cursor-pointer hover:bg-gray-50 transition-colors" id="prev-testimonial">
        <div aria-hidden="true" class="absolute border-2 border-[#0c0801] border-solid inset-0 pointer-events-none rounded-[100px]" />
        <Icon name="ph:arrow-left" class="overflow-clip relative shrink-0 size-6 text-[#0c0801]" />
      </div>
      
      <!-- Right Arrow -->
      <div class="absolute bg-white box-border content-stretch flex gap-2 items-center justify-center p-[12px] right-0 rounded-[100px] top-[142.67px] cursor-pointer hover:bg-gray-50 transition-colors" id="next-testimonial">
        <div aria-hidden="true" class="absolute border-2 border-[#0c0801] border-solid inset-0 pointer-events-none rounded-[100px]" />
        <Icon name="ph:arrow-right" class="overflow-clip relative shrink-0 size-6 text-[#0c0801]" />
      </div>
      
      <!-- Slider Dots -->
      <div class="h-7 relative shrink-0 w-[45px]">
        <div class="flex gap-2 items-center justify-center h-full" id="testimonial-dots">
          {testimonials.map((_, index) => (
            <button 
              class={`w-3 h-3 rounded-full transition-all duration-300 testimonial-dot ${index === 0 ? 'bg-[#0c0801]' : 'bg-gray-300'}`}
              data-index={index}
            ></button>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ testimonials }}>
  document.addEventListener('DOMContentLoaded', function() {
    let currentIndex = 0;
    const totalTestimonials = testimonials.length;
    
    function updateTestimonial(index) {
      const testimonial = testimonials[index];
      if (!testimonial) return;
      
      // Update content
      document.getElementById('testimonial-logo').src = testimonial.logo;
      document.getElementById('testimonial-text').textContent = `"${testimonial.testimonial}"`;
      document.getElementById('testimonial-avatar').src = testimonial.author.avatar;
      document.getElementById('testimonial-avatar').alt = testimonial.author.name;
      document.getElementById('testimonial-name').textContent = testimonial.author.name;
      document.getElementById('testimonial-position').textContent = testimonial.author.position;
      
      // Update dots
      document.querySelectorAll('.testimonial-dot').forEach((dot, dotIndex) => {
        if (dotIndex === index) {
          dot.classList.remove('bg-gray-300');
          dot.classList.add('bg-[#0c0801]');
        } else {
          dot.classList.remove('bg-[#0c0801]');
          dot.classList.add('bg-gray-300');
        }
      });
    }
    
    function nextTestimonial() {
      currentIndex = (currentIndex + 1) % totalTestimonials;
      updateTestimonial(currentIndex);
    }
    
    function prevTestimonial() {
      currentIndex = currentIndex === 0 ? totalTestimonials - 1 : currentIndex - 1;
      updateTestimonial(currentIndex);
    }
    
    // Event listeners
    document.getElementById('next-testimonial')?.addEventListener('click', nextTestimonial);
    document.getElementById('prev-testimonial')?.addEventListener('click', prevTestimonial);
    
    // Dot navigation
    document.querySelectorAll('.testimonial-dot').forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentIndex = index;
        updateTestimonial(currentIndex);
      });
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        prevTestimonial();
      } else if (e.key === 'ArrowRight') {
        nextTestimonial();
      }
    });
    
    // Auto-advance slider (optional)
    // setInterval(nextTestimonial, 5000); // Change every 5 seconds
  });
</script>