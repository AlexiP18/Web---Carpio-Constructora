---
import { Icon } from 'astro-icon/components';

// Testimonios embebidos específicos para la página "Quiénes Somos"
const testimonials = [
  {
    testimonial: "Constructora Carpio superó nuestras expectativas en cada etapa del proyecto, demostrando un compromiso excepcional con la calidad y los plazos de entrega.",
    author: {
      name: "Juan Pérez",
      position: "Propietario, Residencial Los Robles"
    }
  },
  {
    testimonial: "La profesionalidad y experiencia del equipo de Constructora Carpio hizo que nuestro proyecto se completara sin contratiempos. Altamente recomendados.",
    author: {
      name: "María González",
      position: "Directora, Empresa Constructora ABC"
    }
  },
  {
    testimonial: "Excelente trabajo en nuestro complejo residencial. La atención al detalle y la calidad de construcción fueron excepcionales.",
    author: {
      name: "Carlos Rodríguez",
      position: "Gerente de Proyectos, Inmobiliaria XYZ"
    }
  }
];
---

<section class="bg-white py-12 relative overflow-hidden">
  <!-- Decorative background elements -->
  <div class="absolute top-10 left-10 w-24 h-24 bg-brand-primary/5 rounded-full blur-2xl"></div>
  <div class="absolute bottom-10 right-10 w-32 h-32 bg-brand-secondary/5 rounded-full blur-2xl"></div>

  <div class="max-w-6xl mx-auto px-6">
    <!-- Header Section -->
    <div class="text-center mb-12" data-aos="fade-up">
      <div class="inline-flex items-center gap-2 bg-brand-primary/10 backdrop-blur-sm border border-brand-primary/20 rounded-full px-3 py-1 mb-4">
        <Icon name="ph:quotes-fill" class="w-4 h-4 text-brand-primary" />
        <span class="text-brand-primary font-semibold text-xs">Testimonios</span>
      </div>
      
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
        Lo que dicen nuestros 
        <span class="text-brand-primary">
          clientes
        </span>
      </h2>
    </div>

    <!-- Testimonial Slider -->
    <div class="relative max-w-3xl mx-auto" id="testimonial-container">
      <div class="bg-gray-50 rounded-2xl p-8 text-center shadow-md border" data-aos="fade-up" data-aos-delay="200">
        
        <!-- Quote Icon -->
        <div class="w-12 h-12 bg-brand-primary/10 rounded-xl flex items-center justify-center mx-auto mb-6">
          <Icon name="ph:quotes-fill" class="w-6 h-6 text-brand-primary" />
        </div>
        
        <!-- Testimonial Text -->
        <blockquote class="text-lg lg:text-xl font-medium text-gray-900 leading-relaxed mb-8 max-w-2xl mx-auto">
          <span id="testimonial-text">"{testimonials[0].testimonial}"</span>
        </blockquote>
        
        <!-- Author Info -->
        <div class="flex flex-col items-center">
          <div class="text-center">
            <div id="testimonial-name" class="text-lg font-bold text-gray-900 mb-1">{testimonials[0].author.name}</div>
            <div id="testimonial-position" class="text-brand-primary font-semibold text-sm">{testimonials[0].author.position}</div>
          </div>
        </div>
      </div>
      
      <!-- Navigation Arrows -->
      <button class="absolute left-3 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white hover:bg-brand-primary rounded-full shadow-md border border-gray-200 hover:border-brand-primary flex items-center justify-center group transition-all duration-300" id="prev-testimonial">
        <Icon name="ph:arrow-left" class="w-5 h-5 text-gray-600 group-hover:text-white" />
      </button>
      
      <button class="absolute right-3 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white hover:bg-brand-primary rounded-full shadow-md border border-gray-200 hover:border-brand-primary flex items-center justify-center group transition-all duration-300" id="next-testimonial">
        <Icon name="ph:arrow-right" class="w-5 h-5 text-gray-600 group-hover:text-white" />
      </button>
      
      <!-- Dots Indicator -->
      <div class="flex justify-center mt-6 gap-2" id="testimonial-dots">
        {testimonials.map((_, index) => (
          <button 
            class={`w-2 h-2 rounded-full transition-all duration-300 testimonial-dot ${index === 0 ? 'bg-brand-primary' : 'bg-gray-300 hover:bg-gray-400'}`}
            data-index={index}
          ></button>
        ))}
      </div>
    </div>

    <!-- Stats Section
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mt-20 max-w-4xl mx-auto" data-aos="fade-up" data-aos-delay="400">
      <div class="text-center">
        <div class="text-3xl font-bold text-primary-green mb-2">150+</div>
        <div class="text-gray-600">Proyectos Completados</div>
      </div>
      <div class="text-center">
        <div class="text-3xl font-bold text-primary-green mb-2">50+</div>
        <div class="text-gray-600">Clientes Satisfechos</div>
      </div>
      <div class="text-center">
        <div class="text-3xl font-bold text-primary-green mb-2">15+</div>
        <div class="text-gray-600">Años de Experiencia</div>
      </div>
      <div class="text-center">
        <div class="text-3xl font-bold text-primary-green mb-2">100%</div>
        <div class="text-gray-600">Satisfacción</div>
      </div>
    </div> -->
  </div>
</section>

<script define:vars={{ testimonials }}>
  document.addEventListener('DOMContentLoaded', function() {
    let currentIndex = 0;
    const totalTestimonials = testimonials.length;
    
    function updateTestimonial(index) {
      const testimonial = testimonials[index];
      if (!testimonial) return;
      
      // Update content with smooth transition
      const testimonialContainer = document.getElementById('testimonial-container');
      testimonialContainer.style.opacity = '0.7';
      
      setTimeout(() => {
        document.getElementById('testimonial-text').textContent = `"${testimonial.testimonial}"`;
        document.getElementById('testimonial-name').textContent = testimonial.author.name;
        document.getElementById('testimonial-position').textContent = testimonial.author.position;
        
        // Update dots
        document.querySelectorAll('.testimonial-dot').forEach((dot, dotIndex) => {
          if (dotIndex === index) {
            dot.classList.remove('bg-gray-300');
            dot.classList.add('bg-brand-primary');
          } else {
            dot.classList.remove('bg-brand-primary');
            dot.classList.add('bg-gray-300');
          }
        });
        
        testimonialContainer.style.opacity = '1';
      }, 150);
    }
    
    function nextTestimonial() {
      currentIndex = (currentIndex + 1) % totalTestimonials;
      updateTestimonial(currentIndex);
    }
    
    function prevTestimonial() {
      currentIndex = currentIndex === 0 ? totalTestimonials - 1 : currentIndex - 1;
      updateTestimonial(currentIndex);
    }
    
    // Event listeners
    document.getElementById('next-testimonial')?.addEventListener('click', nextTestimonial);
    document.getElementById('prev-testimonial')?.addEventListener('click', prevTestimonial);
    
    // Dot navigation
    document.querySelectorAll('.testimonial-dot').forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentIndex = index;
        updateTestimonial(currentIndex);
      });
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        prevTestimonial();
      } else if (e.key === 'ArrowRight') {
        nextTestimonial();
      }
    });
    
    // Auto-advance slider every 7 seconds
    setInterval(nextTestimonial, 7000);
  });
</script>