---
import { Icon } from "astro-icon/components";
import Button from '../../ui/Button.astro';

export interface Props {
  testimonials: Array<{
    rating: number;
    quote: string;
    name: string;
    position: string;
    logo: string;
    image: string;
  }>;
}

const { testimonials } = Astro.props;
---

<section class="py-20 bg-gradient-to-br from-gray-50 via-white to-gray-50 relative overflow-hidden">
  <!-- Decorative background elements -->
  <div class="absolute top-0 left-0 w-72 h-72 bg-brand-primary/5 rounded-full blur-3xl"></div>
  <div class="absolute bottom-0 right-0 w-96 h-96 bg-brand-secondary/5 rounded-full blur-3xl"></div>

  <div class="max-w-7xl mx-auto px-6 relative z-10">
    
    <!-- Section Header -->
    <div class="text-center max-w-4xl mx-auto mb-16" data-aos="fade-up">
      <div class="inline-flex items-center gap-2 bg-brand-primary/10 backdrop-blur-sm border border-brand-primary/20 rounded-full px-4 py-2 mb-6">
        <Icon name="ph:chat-circle-text" class="w-5 h-5 text-brand-primary" />
        <span class="text-brand-primary font-semibold text-sm uppercase tracking-wider">Testimonios del Proyecto</span>
      </div>
      
      <h2 class="text-4xl lg:text-6xl font-bold text-gray-900 leading-tight mb-6">
        Lo Que Dicen Nuestros Clientes
      </h2>
      
      <p class="text-xl text-gray-600 leading-relaxed">
        Experiencias reales de quienes confiaron en nosotros para sus proyectos
      </p>
    </div>

    <!-- Testimonial Container -->
    <div class="bg-white rounded-3xl shadow-2xl border border-gray-100 relative overflow-hidden mb-16" data-aos="fade-up" data-aos-delay="200">
      
      <!-- Testimonial Slider -->
      <div id="project-testimonial-slider" class="flex transition-transform duration-500 ease-in-out">
        
        {testimonials.map((testimonial, index) => (
          <div class="w-full flex-shrink-0 p-8 lg:p-12">
            <div class="grid lg:grid-cols-2 gap-8 items-center">
              
              <!-- Image Side -->
              <div class="relative">
                <div class="h-80 lg:h-96 rounded-2xl overflow-hidden shadow-xl">
                  <img
                    src={testimonial.image}
                    alt={testimonial.name}
                    class="w-full h-full object-cover"
                  />
                </div>
                <!-- Decorative element -->
                <div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-br from-brand-primary to-brand-primary/70 rounded-2xl opacity-20"></div>
              </div>

              <!-- Content Side -->
              <div class="space-y-6">
                <!-- Rating Stars -->
                <div class="flex gap-1">
                  {Array.from({ length: testimonial.rating }).map(() => (
                    <Icon name="ph:star-fill" class="w-6 h-6 text-brand-secondary" />
                  ))}
                  {Array.from({ length: 5 - testimonial.rating }).map(() => (
                    <Icon name="ph:star" class="w-6 h-6 text-gray-300" />
                  ))}
                </div>
                
                <!-- Quote -->
                <blockquote class="text-2xl lg:text-3xl text-gray-900 leading-relaxed font-medium">
                  "{testimonial.quote}"
                </blockquote>
                
                <!-- Author Info -->
                <div class="flex items-center gap-6 pt-6 border-t border-gray-100">
                  <div class="flex flex-col">
                    <div class="text-xl font-bold text-gray-900">{testimonial.name}</div>
                    <div class="text-gray-600 font-medium">{testimonial.position}</div>
                  </div>
                  
                  <!-- Company Logo -->
                  <div class="h-10 w-28 ml-auto">
                    <img 
                      src={testimonial.logo} 
                      alt="Company Logo" 
                      class="h-full w-full object-contain opacity-60"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
      
      <!-- Navigation Arrows -->
      <button
        id="prev-project-testimonial"
        class="absolute left-4 top-1/2 transform -translate-y-1/2 w-12 h-12 bg-white/90 backdrop-blur-sm hover:bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group"
        aria-label="Testimonio anterior"
      >
        <Icon name="ph:caret-left" class="w-5 h-5 text-gray-900 group-hover:text-brand-primary transition-colors" />
      </button>
      <button
        id="next-project-testimonial"
        class="absolute right-4 top-1/2 transform -translate-y-1/2 w-12 h-12 bg-white/90 backdrop-blur-sm hover:bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group"
        aria-label="Siguiente testimonio"
      >
        <Icon name="ph:caret-right" class="w-5 h-5 text-gray-900 group-hover:text-brand-primary transition-colors" />
      </button>
    </div>
    
    <!-- Dots Navigation -->
    <div class="flex gap-3 items-center justify-center mb-16" data-aos="fade-up" data-aos-delay="300">
      {testimonials.map((_, index) => (
        <button
          class={`project-testimonial-dot w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-brand-primary w-8' : 'bg-gray-300 hover:bg-brand-primary/50'}`}
          data-slide={index}
          aria-label={`Ir al testimonio ${index + 1}`}
        ></button>
      ))}
    </div>

    <!-- Call to Action -->
    <div class="grid lg:grid-cols-2 gap-8" data-aos="fade-up" data-aos-delay="400">
      <div class="bg-gradient-to-br from-brand-primary to-brand-primary/80 rounded-3xl shadow-2xl p-8 text-center relative overflow-hidden">
        <!-- Decorative elements -->
        <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-xl"></div>
        <div class="absolute bottom-0 left-0 w-16 h-16 bg-white/10 rounded-full blur-lg"></div>
        
        <div class="relative z-10">
          <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
            <Icon name="ph:rocket-launch" class="w-8 h-8 text-white" />
          </div>
          <h3 class="text-2xl font-bold text-white mb-4">¿Quieres ser nuestro próximo cliente satisfecho?</h3>
          <p class="text-white/90 mb-6 leading-relaxed">Únete a más de 150 clientes que han confiado en nosotros</p>
          
          <Button 
            variant="outline"
            size="lg"
            iconPosition="left"
            icon="ph:heart"
            animation="hover"
            href="/contacto"
            class="bg-white text-brand-primary hover:bg-gray-50 border-white"
          >
            Iniciar Mi Proyecto
          </Button>
        </div>
      </div>
      
      <div class="bg-white rounded-3xl shadow-2xl border border-gray-100 p-8 text-center relative overflow-hidden">
        <!-- Decorative elements -->
        <div class="absolute top-0 right-0 w-20 h-20 bg-brand-secondary/5 rounded-full blur-xl"></div>
        <div class="absolute bottom-0 left-0 w-16 h-16 bg-brand-primary/5 rounded-full blur-lg"></div>
        
        <div class="relative z-10">
          <div class="w-16 h-16 bg-gradient-to-br from-brand-secondary to-brand-secondary/80 rounded-2xl flex items-center justify-center mx-auto mb-6">
            <Icon name="ph:chat-circle" class="w-8 h-8 text-white" />
          </div>
          <h3 class="text-2xl font-bold text-gray-900 mb-4">¿Tienes alguna pregunta?</h3>
          <p class="text-gray-600 mb-6 leading-relaxed">Nuestro equipo está listo para ayudarte</p>
          
          <Button 
            variant="outline-dark"
            size="lg"
            iconPosition="left"
            icon="ph:user"
            animation="hover"
            href="/contacto"
          >
            Hablar con un Experto
          </Button>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('project-testimonial-slider');
    const prevBtn = document.getElementById('prev-project-testimonial');
    const nextBtn = document.getElementById('next-project-testimonial');
    const dots = document.querySelectorAll('.project-testimonial-dot');
    
    let currentSlide = 0;
    const totalSlides = dots.length;

    function updateSlider() {
      if (slider) {
        const translateX = -currentSlide * 100;
        slider.style.transform = `translateX(${translateX}%)`;
      }
      
      // Update dots
      dots.forEach((dot, index) => {
        if (index === currentSlide) {
          dot.classList.remove('bg-gray-300', 'w-3');
          dot.classList.add('bg-brand-primary', 'w-8');
        } else {
          dot.classList.remove('bg-brand-primary', 'w-8');
          dot.classList.add('bg-gray-300', 'w-3');
        }
      });
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateSlider();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateSlider();
    }

    // Event listeners
    nextBtn?.addEventListener('click', nextSlide);
    prevBtn?.addEventListener('click', prevSlide);

    // Dot navigation
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentSlide = index;
        updateSlider();
      });
    });

    // Auto-play slider every 7 seconds
    setInterval(nextSlide, 7000);

    // Touch/swipe support for mobile
    let startX = 0;
    let startY = 0;

    slider?.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });

    slider?.addEventListener('touchend', (e) => {
      if (!startX || !startY) return;

      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;

      const diffX = startX - endX;
      const diffY = startY - endY;

      // Only trigger if horizontal swipe is greater than vertical
      if (Math.abs(diffX) > Math.abs(diffY)) {
        if (diffX > 50) {
          nextSlide();
        } else if (diffX < -50) {
          prevSlide();
        }
      }

      startX = 0;
      startY = 0;
    });
  });
</script>