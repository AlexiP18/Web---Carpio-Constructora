---
// Componente simplificado sin dependencias externas
export interface Props {
  testimonials: Array<{
    rating: number;
    quote: string;
    name: string;
    position: string;
    logo: string;
    image: string;
  }>;
}

const { testimonials } = Astro.props;
---

<section class="py-16 lg:py-24 bg-gray-600">
  <div class="max-w-4xl mx-auto px-6">
    
    <!-- Section Header -->
    <div class="text-center mb-12">
      <p class="text-sm font-medium text-white/80 uppercase tracking-wider mb-4">
        Testimonios del Proyecto
      </p>
      <h2 class="text-3xl lg:text-4xl font-bold text-white mb-4">
        Lo Que Dicen Nuestros Clientes
      </h2>
      <p class="text-lg text-white/80 max-w-2xl mx-auto">
        Experiencias reales de quienes confiaron en nosotros para sus proyectos
      </p>
    </div>

    <!-- Testimonial Container -->
    <div class="bg-gray-700 rounded-lg shadow-lg p-8 lg:p-12 relative overflow-hidden">
      
      <!-- Testimonial Slider -->
      <div id="project-testimonial-slider" class="flex transition-transform duration-500 ease-in-out">
        
        {testimonials.map((testimonial, index) => (
          <div class="w-full flex-shrink-0">
            <div class="grid lg:grid-cols-2 gap-8 items-center">
              
              <!-- Image Side -->
              <div class="relative">
                <div class="h-80 lg:h-96 rounded-lg overflow-hidden">
                  <img
                    src={testimonial.image}
                    alt={testimonial.name}
                    class="w-full h-full object-cover"
                  />
                </div>
              </div>

              <!-- Content Side -->
              <div class="space-y-6">
                <!-- Rating Stars -->
                <div class="flex gap-1">
                  {Array.from({ length: testimonial.rating }).map(() => (
                    <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  ))}
                </div>
                
                <!-- Quote -->
                <blockquote class="text-xl lg:text-2xl text-white leading-relaxed font-medium">
                  "{testimonial.quote}"
                </blockquote>
                
                <!-- Author Info -->
                <div class="flex items-center gap-6">
                  <div class="flex flex-col text-white">
                    <div class="text-lg font-bold">{testimonial.name}</div>
                    <div class="text-white/70">{testimonial.position}</div>
                  </div>
                  
                  <!-- Company Logo -->
                  <div class="h-8 w-24">
                    <img 
                      src={testimonial.logo} 
                      alt="Company Logo" 
                      class="h-full w-full object-contain opacity-60"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
      
      <!-- Navigation Arrows -->
      <button
        id="prev-project-testimonial"
        class="absolute left-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-white/20 hover:bg-white/30 text-white transition-all duration-200 shadow-md"
        aria-label="Testimonio anterior"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
        </svg>
      </button>
      <button
        id="next-project-testimonial"
        class="absolute right-4 top-1/2 transform -translate-y-1/2 p-3 rounded-full bg-white/20 hover:bg-white/30 text-white transition-all duration-200 shadow-md"
        aria-label="Siguiente testimonio"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>
    
    <!-- Dots Navigation -->
    <div class="flex gap-3 items-center justify-center mt-8">
      {testimonials.map((_, index) => (
        <button
          class={`project-testimonial-dot w-3 h-3 rounded-full transition-all duration-200 ${index === 0 ? 'bg-white' : 'bg-white/30 hover:bg-white/50'}`}
          data-slide={index}
          aria-label={`Ir al testimonio ${index + 1}`}
        ></button>
      ))}
    </div>

    <!-- Call to Action -->
    <div class="grid lg:grid-cols-2 gap-6 mt-12">
      <div class="bg-gray-700 rounded-lg p-6 text-center border border-gray-600">
        <h3 class="text-xl font-bold text-white mb-3">¿Quieres ser nuestro próximo cliente satisfecho?</h3>
        <p class="text-white/70 mb-4">Únete a más de 150 clientes que han confiado en nosotros</p>
        <a href="/contacto" class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200">
          Iniciar Mi Proyecto
        </a>
      </div>
      
      <div class="bg-gray-700 rounded-lg p-6 text-center border border-gray-600">
        <h3 class="text-xl font-bold text-white mb-3">¿Tienes alguna pregunta?</h3>
        <p class="text-white/70 mb-4">Nuestro equipo está listo para ayudarte</p>
        <a href="/contacto" class="inline-flex items-center gap-2 bg-transparent hover:bg-white/10 text-white border border-white/30 hover:border-white/50 px-6 py-3 rounded-lg font-medium transition-all duration-200">
          Hablar con un Experto
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('project-testimonial-slider');
    const prevBtn = document.getElementById('prev-project-testimonial');
    const nextBtn = document.getElementById('next-project-testimonial');
    const dots = document.querySelectorAll('.project-testimonial-dot');
    
    let currentSlide = 0;
    const totalSlides = dots.length;

    function updateSlider() {
      if (slider) {
        const translateX = -currentSlide * 100;
        slider.style.transform = `translateX(${translateX}%)`;
      }
      
      // Update dots
      dots.forEach((dot, index) => {
        if (index === currentSlide) {
          dot.classList.remove('bg-white/30');
          dot.classList.add('bg-white');
        } else {
          dot.classList.remove('bg-white');
          dot.classList.add('bg-white/30');
        }
      });
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateSlider();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateSlider();
    }

    // Event listeners
    nextBtn?.addEventListener('click', nextSlide);
    prevBtn?.addEventListener('click', prevSlide);

    // Dot navigation
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentSlide = index;
        updateSlider();
      });
    });

    // Auto-play slider every 7 seconds
    setInterval(nextSlide, 7000);

    // Touch/swipe support for mobile
    let startX = 0;
    let startY = 0;

    slider?.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });

    slider?.addEventListener('touchend', (e) => {
      if (!startX || !startY) return;

      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;

      const diffX = startX - endX;
      const diffY = startY - endY;

      // Only trigger if horizontal swipe is greater than vertical
      if (Math.abs(diffX) > Math.abs(diffY)) {
        if (diffX > 50) {
          nextSlide();
        } else if (diffX < -50) {
          prevSlide();
        }
      }

      startX = 0;
      startY = 0;
    });
  });
</script>