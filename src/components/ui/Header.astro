---
import { Icon } from 'astro-icon/components';

// Asset constants from Figma
const imgLogoWide1 = "http://localhost:3845/assets/be494146a3b9256c52a443ebe0b1138fbd3142c2.svg";
---

<header class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-md w-full z-50 border-b border-gray-100 shadow-sm transition-all duration-300" id="header">
  <nav class="w-full">
    <!-- Mobile Header -->
    <div class="lg:hidden flex h-14 sm:h-16 items-center justify-between px-4 sm:px-6 py-0 box-border transition-all duration-300">
      <!-- Logo -->
      <div class="flex items-center justify-start">
        <div class="h-7 sm:h-9 w-[70px] sm:w-[84px] overflow-clip relative">
          <img src={imgLogoWide1} alt="Constructora Carpio" class="block max-w-none size-full transition-opacity duration-300" />
        </div>
      </div>
      
      <!-- Mobile Actions Container -->
      <div class="flex items-center gap-2 sm:gap-3">
        <!-- Quick Call Button -->
        <a 
          href="tel:0956324598"
          class="hidden xs:flex items-center justify-center w-10 h-10 bg-forest-green/10 hover:bg-forest-green hover:text-white rounded-lg transition-all duration-200 group"
          aria-label="Llamar ahora"
        >
          <Icon name="ph:phone" class="w-4 h-4 text-forest-green group-hover:text-white transition-colors duration-200" />
        </a>
        
        <!-- WhatsApp Quick Button -->
        <a 
          href="https://wa.me/50688887777"
          target="_blank"
          class="hidden sm:flex items-center justify-center w-10 h-10 bg-green-500/10 hover:bg-green-500 hover:text-white rounded-lg transition-all duration-200 group"
          aria-label="Escribir por WhatsApp"
        >
          <Icon name="ph:whatsapp-logo" class="w-4 h-4 text-green-500 group-hover:text-white transition-colors duration-200" />
        </a>
        
        <!-- Mobile Menu Button -->
        <button 
          class="flex gap-2.5 items-center justify-center relative w-10 h-10 sm:w-12 sm:h-12 hover:bg-gray-50 rounded-lg transition-colors duration-200 border border-gray-200"
          id="mobile-menu-toggle"
          aria-label="Abrir menú de navegación"
        >
          <Icon name="ph:list" class="w-5 h-5 sm:w-6 sm:h-6 text-neutral-darkest" />
        </button>
      </div>
    </div>

    <!-- Desktop Header -->
    <div class="hidden lg:flex h-[72px] items-center justify-center px-16 py-0 box-border transition-all duration-300">
      <div class="flex items-center justify-between relative w-full max-w-container-large">
        <!-- Logo -->
        <div class="flex h-10 items-center justify-center relative w-20">
          <div class="h-9 overflow-clip relative w-[84px]">
            <img src={imgLogoWide1} alt="Constructora Carpio" class="block max-w-none size-full transition-opacity duration-300" />
          </div>
        </div>
        
        <!-- Desktop Navigation -->
        <div class="flex gap-8 items-center justify-center relative">
          <!-- Nav Links -->
          <nav class="flex gap-8 items-center justify-end relative">
            <a href="/" class="font-heebo font-normal text-text-regular text-neutral-darkest hover:text-forest-green transition-colors duration-200 relative group">
              Inicio
              <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-forest-green transition-all duration-300 group-hover:w-full"></span>
            </a>
            <a href="/quienes-somos" class="font-heebo font-normal text-text-regular text-neutral-darkest hover:text-forest-green transition-colors duration-200 relative group">
              Nosotros
              <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-forest-green transition-all duration-300 group-hover:w-full"></span>
            </a>
            
            <!-- Services Dropdown -->
            <div class="relative group">
              <button class="flex gap-1 items-center justify-start relative hover:text-forest-green transition-colors duration-200">
                <span class="font-heebo font-normal text-text-regular text-neutral-darkest group-hover:text-forest-green transition-colors duration-200">
                  Servicios
                </span>
                <Icon name="ph:caret-down" class="w-4 h-4 transition-transform duration-300 group-hover:rotate-180" />
              </button>
              <!-- Dropdown Menu -->
              <div class="absolute top-full left-0 mt-2 w-64 bg-white/95 backdrop-blur-md rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transform translate-y-2 group-hover:translate-y-0 transition-all duration-300 z-50">
                <div class="py-3">
                  <a href="/servicios" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:buildings" class="w-5 h-5" />
                      <span>Todos los Servicios</span>
                    </div>
                  </a>
                  <a href="/servicios/construccion" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:hammer" class="w-5 h-5" />
                      <span>Construcción</span>
                    </div>
                  </a>
                  <a href="/servicios/remodelacion" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:wrench" class="w-5 h-5" />
                      <span>Remodelación</span>
                    </div>
                  </a>
                  <a href="/servicios/mantenimiento" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:gear" class="w-5 h-5" />
                      <span>Mantenimiento</span>
                    </div>
                  </a>
                </div>
              </div>
            </div>
            
            <!-- Projects Dropdown -->
            <div class="relative group">
              <button class="flex gap-1 items-center justify-start relative hover:text-forest-green transition-colors duration-200">
                <span class="font-heebo font-normal text-text-regular text-neutral-darkest group-hover:text-forest-green transition-colors duration-200">
                  Proyectos
                </span>
                <Icon name="ph:caret-down" class="w-4 h-4 transition-transform duration-300 group-hover:rotate-180" />
              </button>
              <!-- Dropdown Menu -->
              <div class="absolute top-full left-0 mt-2 w-64 bg-white/95 backdrop-blur-md rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transform translate-y-2 group-hover:translate-y-0 transition-all duration-300 z-50">
                <div class="py-3">
                  <a href="/proyectos" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:folder-open" class="w-5 h-5" />
                      <span>Todos los Proyectos</span>
                    </div>
                  </a>
                  <a href="/proyecto/proyecto-residencial-moderno" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:house" class="w-5 h-5" />
                      <span>Proyecto Residencial</span>
                    </div>
                  </a>
                  <a href="/proyecto/centro-comercial-innovador" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:storefront" class="w-5 h-5" />
                      <span>Centro Comercial</span>
                    </div>
                  </a>
                  <a href="/proyecto/parque-recreativo-familiar" class="block px-4 py-3 font-heebo text-neutral-darkest hover:bg-forest-green/10 hover:text-forest-green transition-all duration-200 border-l-4 border-transparent hover:border-forest-green">
                    <div class="flex items-center gap-3">
                      <Icon name="ph:tree" class="w-5 h-5" />
                      <span>Parque Recreativo</span>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </nav>
          
          <!-- Action Buttons -->
          <div class="flex gap-4 items-center justify-center relative">
            <!-- Phone Button -->
            <div class="bg-neutral-lightest/80 backdrop-blur-sm box-border flex gap-2 items-center justify-center px-5 py-2 relative rounded-full border-2 border-neutral-darkest/10 shadow-sm hover:bg-neutral-lighter hover:shadow-md transition-all duration-300">
              <Icon name="ph:phone" class="w-4 h-4 text-neutral-darkest" />
              <span class="font-heebo font-medium text-text-regular text-neutral-darkest">
                0956324598
              </span>
            </div>
            
            <!-- Contact Button -->
            <a href="/contacto" class="bg-forest-green box-border flex gap-2 items-center justify-center px-6 py-2.5 relative rounded-full border-2 border-forest-green shadow-sm hover:bg-green-700 hover:shadow-md transform hover:scale-105 transition-all duration-300">
              <Icon name="ph:envelope-simple" class="w-4 h-4 text-white" />
              <span class="font-heebo font-medium text-text-regular text-white">
                Contacto
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Overlay (Hidden by default) -->
    <div 
      id="mobile-menu" 
      class="lg:hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] opacity-0 invisible transition-all duration-300 ease-in-out"
      style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh;"
    >
      <!-- Mobile Menu Panel -->
      <div 
        class="fixed left-0 top-0 h-full w-[320px] max-w-[85vw] bg-white backdrop-blur-lg transform -translate-x-full transition-transform duration-300 ease-in-out shadow-2xl border-r border-gray-100"
        style="position: fixed; top: 0; left: 0; height: 100vh; z-index: 10000;"
      >
        <div class="flex flex-col h-full" style="height: 100vh;">
          <!-- Mobile Menu Header -->
          <div class="flex h-16 items-center justify-between px-6 py-0 border-b border-gray-100 bg-gradient-to-r from-forest-green/5 to-transparent flex-shrink-0">
            <div class="flex items-center gap-3">
              <img src={imgLogoWide1} alt="Constructora Carpio" class="h-8 flex-shrink-0" />
            </div>
            <button 
              id="mobile-menu-close"
              class="flex items-center justify-center w-10 h-10 flex-shrink-0 hover:bg-red-50 rounded-lg transition-colors duration-200 group border border-gray-200"
              aria-label="Cerrar menú"
            >
              <Icon name="ph:x" class="w-5 h-5 text-neutral-darkest group-hover:text-red-600 transition-colors duration-200" />
            </button>
          </div>
        
          <!-- Mobile Menu Content -->
          <div class="flex-1 flex flex-col overflow-hidden" style="flex: 1; min-height: 0;">
            <!-- Navigation Links -->
            <div class="flex-1 overflow-y-auto py-6 px-6" style="flex: 1; overflow-y: auto;">
              <nav class="space-y-3">
                <a 
                  href="/" 
                  class="mobile-nav-link group active"
                >
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-forest-green/10 rounded-xl flex items-center justify-center group-hover:bg-forest-green group-hover:scale-110 transition-all duration-200">
                      <Icon name="ph:house" class="w-5 h-5 text-forest-green group-hover:text-white transition-colors duration-200" />
                    </div>
                    <span class="font-medium">Inicio</span>
                  </div>
                  <Icon name="ph:caret-right" class="w-5 h-5 text-gray-400 group-hover:text-forest-green group-hover:translate-x-1 transition-all duration-200" />
                </a>
                
                <a 
                  href="/quienes-somos" 
                  class="mobile-nav-link group"
                >
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-forest-green/10 rounded-xl flex items-center justify-center group-hover:bg-forest-green group-hover:scale-110 transition-all duration-200">
                      <Icon name="ph:users" class="w-5 h-5 text-forest-green group-hover:text-white transition-colors duration-200" />
                    </div>
                    <span class="font-medium">Quiénes Somos</span>
                  </div>
                  <Icon name="ph:caret-right" class="w-5 h-5 text-gray-400 group-hover:text-forest-green group-hover:translate-x-1 transition-all duration-200" />
                </a>
                
                <!-- Services Section -->
                <div class="py-4">
                  <h4 class="text-sm font-bold text-gray-600 uppercase tracking-wide mb-4 px-4 flex items-center gap-2">
                    <Icon name="ph:buildings" class="w-4 h-4 text-forest-green" />
                    Servicios
                  </h4>
                  <div class="space-y-2 pl-4">
                    <a href="/servicios" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:list" class="w-4 h-4 text-forest-green" />
                        <span>Todos los Servicios</span>
                      </div>
                    </a>
                    <a href="/servicios/construccion" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:hammer" class="w-4 h-4 text-gray-500" />
                        <span>Construcción</span>
                      </div>
                    </a>
                    <a href="/servicios/remodelacion" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:wrench" class="w-4 h-4 text-gray-500" />
                        <span>Remodelación</span>
                      </div>
                    </a>
                    <a href="/servicios/mantenimiento" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:gear" class="w-4 h-4 text-gray-500" />
                        <span>Mantenimiento</span>
                      </div>
                    </a>
                  </div>
                </div>
                
                <!-- Projects Section -->
                <div class="py-4">
                  <h4 class="text-sm font-bold text-gray-600 uppercase tracking-wide mb-4 px-4 flex items-center gap-2">
                    <Icon name="ph:folder-open" class="w-4 h-4 text-forest-green" />
                    Proyectos
                  </h4>
                  <div class="space-y-2 pl-4">
                    <a href="/proyectos" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:list" class="w-4 h-4 text-forest-green" />
                        <span>Todos los Proyectos</span>
                      </div>
                    </a>
                    <a href="/proyecto/proyecto-residencial-moderno" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:house" class="w-4 h-4 text-gray-500" />
                        <span>Proyecto Residencial</span>
                      </div>
                    </a>
                    <a href="/proyecto/centro-comercial-innovador" class="mobile-nav-link group sub-item">
                      <div class="flex items-center gap-3">
                        <Icon name="ph:storefront" class="w-4 h-4 text-gray-500" />
                        <span>Centro Comercial</span>
                      </div>
                    </a>
                  </div>
                </div>
              </nav>
            </div>
            
            <!-- Mobile Contact Section -->
            <div class="p-6 border-t border-gray-100 bg-gradient-to-t from-gray-50/50 to-transparent space-y-4 flex-shrink-0">
              <!-- Primary CTA -->
              <a 
                href="/contacto" 
                class="bg-forest-green text-white px-6 py-4 rounded-xl font-heebo font-bold text-base w-full hover:bg-green-700 transform hover:scale-[1.02] transition-all duration-300 shadow-lg flex items-center justify-center gap-3"
              >
                <Icon name="ph:envelope-simple" class="w-5 h-5" />
                Solicitar Cotización
              </a>
              
              <!-- Quick Actions Grid -->
              <div class="grid grid-cols-2 gap-3">
                <a 
                  href="tel:0956324598" 
                  class="bg-white border border-gray-200 text-neutral-darkest px-4 py-3 rounded-xl font-heebo font-medium text-sm hover:bg-gray-50 hover:border-forest-green transition-all duration-300 flex items-center justify-center gap-2"
                >
                  <Icon name="ph:phone" class="w-4 h-4" />
                  <span>Llamar</span>
                </a>
                <a 
                  href="https://wa.me/50688887777" 
                  target="_blank"
                  class="bg-green-500 text-white px-4 py-3 rounded-xl font-heebo font-medium text-sm hover:bg-green-600 transition-all duration-300 flex items-center justify-center gap-2"
                >
                  <Icon name="ph:whatsapp-logo" class="w-4 h-4" />
                  <span>WhatsApp</span>
                </a>
              </div>
              
              <!-- Contact Info -->
              <div class="pt-3 space-y-3 text-sm text-gray-600">
                <div class="flex items-center gap-3">
                  <Icon name="ph:clock" class="w-4 h-4 text-forest-green" />
                  <span>Lun-Vie: 8AM-6PM | Sáb: 8AM-2PM</span>
                </div>
                <div class="flex items-center gap-3">
                  <Icon name="ph:map-pin" class="w-4 h-4 text-forest-green" />
                  <span>San José, Costa Rica</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  // Header scroll behavior
  const header = document.getElementById('header');
  let lastScrollY = window.scrollY;
  let isScrollingUp = false;

  function updateHeaderOnScroll() {
    const currentScrollY = window.scrollY;
    isScrollingUp = currentScrollY < lastScrollY;

    if (currentScrollY > 50) {
      header?.classList.add('header-scrolled');
      if (isScrollingUp || currentScrollY < 100) {
        header?.classList.remove('header-hidden');
      } else if (currentScrollY > lastScrollY + 10) {
        header?.classList.add('header-hidden');
      }
    } else {
      header?.classList.remove('header-scrolled', 'header-hidden');
    }

    lastScrollY = currentScrollY;
  }

  // Throttled scroll event listener
  let scrollTimer: number | null = null;
  window.addEventListener('scroll', () => {
    if (scrollTimer) return;
    scrollTimer = requestAnimationFrame(() => {
      updateHeaderOnScroll();
      scrollTimer = null;
    });
  });

  // Mobile menu functionality
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuClose = document.getElementById('mobile-menu-close');
  const mobileMenuPanel = mobileMenu?.querySelector('.fixed') as HTMLElement;

  function openMobileMenu() {
    document.body.classList.add('mobile-menu-open');
    mobileMenu?.classList.remove('opacity-0', 'invisible');
    setTimeout(() => {
      mobileMenuPanel?.classList.remove('-translate-x-full');
    }, 10);
  }

  function closeMobileMenu() {
    document.body.classList.remove('mobile-menu-open');
    mobileMenuPanel?.classList.add('-translate-x-full');
    setTimeout(() => {
      mobileMenu?.classList.add('opacity-0', 'invisible');
    }, 300);
  }

  mobileMenuToggle?.addEventListener('click', openMobileMenu);
  mobileMenuClose?.addEventListener('click', closeMobileMenu);

  // Close menu when clicking on overlay
  mobileMenu?.addEventListener('click', (e) => {
    if (e.target === mobileMenu) {
      closeMobileMenu();
    }
  });

  // Close mobile menu when clicking on links
  const mobileMenuLinks = mobileMenu?.querySelectorAll('a');
  mobileMenuLinks?.forEach(link => {
    link.addEventListener('click', closeMobileMenu);
  });

  // Close mobile menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !mobileMenu?.classList.contains('invisible')) {
      closeMobileMenu();
    }
  });
</script>

<style>
  /* Header scroll styles */
  #header {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #header.header-scrolled {
    @apply bg-white/90 backdrop-blur-lg shadow-lg border-b border-gray-200;
  }

  #header.header-hidden {
    transform: translateY(-100%);
  }

  /* Smooth dropdown animations */
  .group:hover .group-hover\:opacity-100 {
    animation: fadeInDown 0.3s ease-out forwards;
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Mobile menu backdrop */
  #mobile-menu {
    backdrop-filter: blur(8px);
  }

  /* Mobile navigation links */
  .mobile-nav-link {
    @apply flex items-center justify-between w-full px-4 py-4 rounded-xl font-heebo font-medium text-base text-neutral-darkest hover:bg-forest-green/5 hover:text-forest-green transition-all duration-200;
  }

  .mobile-nav-link.sub-item {
    @apply pl-4 py-3 text-sm font-normal rounded-lg;
  }

  .mobile-nav-link.active {
    @apply bg-forest-green/10 text-forest-green;
  }

  /* Mobile menu specific styles */
  #mobile-menu {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 9999 !important;
  }

  #mobile-menu .fixed {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    height: 100vh !important;
    width: 320px !important;
    max-width: 85vw !important;
    z-index: 10000 !important;
  }

  /* Responsive breakpoints */
  @media (min-width: 475px) {
    /* Extra small devices (phones, 475px and up) */
  }

  /* Ensure body padding for fixed header */
  body {
    padding-top: 72px;
  }

  @media (max-width: 1023px) {
    body {
      padding-top: 56px; /* Reduced for mobile */
    }
  }

  @media (max-width: 639px) {
    body {
      padding-top: 56px; /* Even smaller for small mobile */
    }
  }

  /* Mobile menu panel improvements */
  @media (max-width: 374px) {
    #mobile-menu .fixed {
      width: 90%;
    }
  }

  /* Touch improvements */
  @media (hover: none) and (pointer: coarse) {
    .mobile-nav-link:hover {
      @apply bg-forest-green/5;
    }
    
    .mobile-nav-link:active {
      @apply bg-forest-green/15 scale-95;
    }
  }

  /* Prevent body scroll when mobile menu is open */
  body.mobile-menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
  }
</style>