---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/ui/Header.astro";
import Footer from "../../components/sections/Footer.astro";
import ProjectHero from "../../components/sections/project/ProjectHero.astro";
import ProjectContent from "../../components/sections/project/ProjectContent.astro";
import ProjectImageSlider from "../../components/sections/project/ProjectImageSlider.astro";
import ProjectMosaicNew from "../../components/sections/project/ProjectMosaicNew.astro";
import ProjectTestimonials from "../../components/sections/project/ProjectTestimonials.astro";
import { getCollection } from 'astro:content';

// Generar las rutas estáticas desde Astro Content Collections
export async function getStaticPaths() {
  const proyectos = await getCollection('proyectos');
  
  return proyectos.map(proyecto => ({
    params: { slug: proyecto.slug },
    props: { proyecto }
  }));
}

const { proyecto } = Astro.props;
const { Content } = await proyecto.render();

// Extraer datos del frontmatter
const { 
  title, 
  description, 
  tags, 
  backgroundImage, 
  images = [], 
  testimonial, 
  testimonials, 
  virtualTourVideo 
} = proyecto.data;

// Renderizar el contenido markdown como string
const contentHtml = proyecto.body;
---

<Layout title={`${title} - Constructora Carpio`}>
  <Header />
  <main>
    <ProjectHero 
      title={title}
      description={description}
      tags={tags}
      backgroundImage={backgroundImage}
    />
    
    <ProjectContent 
      title={title}
      content={contentHtml}
      images={images}
      virtualTourVideo={virtualTourVideo}
    />
    
    <!-- <ProjectImageSlider 
      images={images}
      title="Galería del Proyecto"
    /> -->
    
    <ProjectMosaicNew 
      images={images}
      title="Explora Cada Detalle"
    />
    
    <!-- <ProjectTestimonials 
      testimonials={testimonials}
    /> -->


  </main>
  <Footer />
</Layout>
