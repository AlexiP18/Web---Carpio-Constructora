---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/ui/Header.astro";
import Footer from "../../components/sections/Footer.astro";
import ProjectHero from "../../components/sections/project/ProjectHero.astro";
import ProjectContent from "../../components/sections/project/ProjectContent.astro";
import ProjectVideo from "../../components/sections/project/ProjectVideo.astro";
import ProjectImageSlider from "../../components/sections/project/ProjectImageSlider.astro";
import ProjectMosaicNew from "../../components/sections/project/ProjectMosaicNew.astro";
import ProjectTestimonials from "../../components/sections/project/ProjectTestimonials.astro";
import { getCollection } from 'astro:content';

// Generar las rutas estáticas desde Astro Content Collections
export async function getStaticPaths() {
  const proyectos = await getCollection('proyectos');
  
  return proyectos.map(proyecto => ({
    params: { slug: proyecto.slug },
    props: { proyecto }
  }));
}

const { proyecto } = Astro.props;
const { Content } = await proyecto.render();

// Extraer datos del frontmatter
const { 
  title, 
  description, 
  tags, 
  backgroundImage, 
  images = [], 
  testimonial, 
  testimonials, 
  virtualTourVideo,
  specifications 
} = proyecto.data;

// Renderizar el contenido markdown como string
const contentHtml = proyecto.body;

// Verificar si es el proyecto Keops
const isKeops = proyecto.slug === 'keops';
// Verificar si es el proyecto Arrayanes de Ficoa (sin especificaciones)
const isFicoa = proyecto.slug === 'los-arrayanes-de-ficoa';
---

<Layout title={`${title} - Constructora Carpio`}>
  <Header />
  <main>
    <ProjectHero 
      title={title}
      description={description}
      tags={tags}
      backgroundImage={backgroundImage}
    />
    
    <!-- Si es Keops, mostrar el video en lugar del ProjectContent -->
    {isKeops && virtualTourVideo ? (
      <ProjectVideo 
        videoUrl={virtualTourVideo}
        title="Recorrido Virtual KEOPs"
        description="Descubre cada detalle de este innovador espacio retail a través de nuestro tour virtual completo"
      />
    ) : (
      <ProjectContent 
        title={title}
        content={contentHtml}
        images={images}
        virtualTourVideo={virtualTourVideo}
        specifications={isFicoa ? undefined : specifications}
      />
    )}
    
    <!-- <ProjectImageSlider 
      images={images}
      title="Galería del Proyecto"
    /> -->
    
    <ProjectMosaicNew 
      images={images}
      title="Explora Cada Detalle"
    />

  </main>
  <Footer />
</Layout>
